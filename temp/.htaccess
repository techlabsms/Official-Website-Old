<IfModule mod_rewrite.c>
# force ssl and non-www for main domain and for all subdomains (except local)

RewriteEngine On

# Block 1 - Weiterleitung auf https:// wenn nicht schon aktiv
RewriteCond %{SERVER_PORT} !=443
RewriteCond %{HTTP_HOST} ^(www\.)?ihre-domain\.de$ [NC]
RewriteRule ^$ https://www.tech-labs.de/%{REQUEST_URI} [R=301,L]

# Block 2 – doppelten Slash entfernen
RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ //+([^\ ]*)
RewriteRule .* https://www.tech-labs.de/%1 [R=301,L]

# Block 3 – URL mit www erzwingen
RewriteCond %{HTTP_HOST} !^www\.ihre-domain\.de$ [NC]
RewriteRule ^(.*)$ https://www.tech-labs.de/$1 [R=301,L]

# Block 4 – index.php entfernen
RewriteCond %{THE_REQUEST} ^.*/index.php
RewriteRule ^(.*)index.php$ https://www.tech-labs.de/$1 [R=301,L]

# main domain
RewriteCond %{HTTP_HOST} ^(www\.)?tld\.org$ [NC]
RewriteCond %{HTTPS} off [OR]
RewriteCond %{HTTP_HOST} ^www\. [NC]
RewriteRule ^ http://tld.org%{REQUEST_URI} [R=301,L,NE]
# subdomains
RewriteCond %{HTTP_HOST} !^local\.tld\.org$ [NC]
RewriteCond %{SERVER_PORT} 80
RewriteCond %{HTTP_HOST} ^((?!www\.)[^.]+)\.tld\.org$
RewriteRule ^ http://%1.tld.org%{REQUEST_URI} [NE,L,R]
</IfModule>
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE text/shtml
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE application/rss+xml
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>
